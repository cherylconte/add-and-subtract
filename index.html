<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Base-10 Addition / Subtraction</title>

<style>
body {
  font-family: Arial, sans-serif;
  background:#f9f9f9;
  margin:0;
  display:flex;
  flex-direction:column;
  align-items:center;
}

h2 { margin:20px; }

#controls {
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  justify-content:center;
}

input, button {
  font-size:16px;
  padding:5px 10px;
}

#availableBlocks {
  margin:20px;
  display:flex;
  gap:10px;
}

.block {
  cursor:pointer;
  display:flex;
  justify-content:center;
  align-items:center;
  color:white;
  font-weight:bold;
  border-radius:4px;
}

.flat { width:200px; height:200px; background:#f06; }
.rod  { width:20px; height:200px; background:#0a0; }
.unit { width:20px; height:20px; background:#06f; }

#board {
  width:90vw;
  display:flex;
  gap:20px;
  border:2px solid #333;
  background:white;
  padding:20px;
}

.column {
  flex:1;
  border-left:1px solid #333;
  position:relative;
  padding-top:30px;
}
.column:first-child { border-left:none; }

.column-label {
  position:absolute;
  top:0;
  width:100%;
  text-align:center;
  font-weight:bold;
}

.row {
  display:flex;
  flex-wrap:wrap;
  gap:5px;
  margin-bottom:10px;
}

#equation {
  margin:40px;
  font-size:36px;
}
</style>
</head>

<body>

<h2>Base-10 Addition / Subtraction</h2>

<div id="controls">
  <input id="problemInput" value="246 + 175">
  <button id="setup">Set Up</button>
  <button id="switchRow">Switch Number</button>
</div>

<div id="availableBlocks">
  <div class="block flat">100</div>
  <div class="block rod">10</div>
  <div class="block unit">1</div>
</div>

<div id="board">
  <div class="column" id="hundreds"><div class="column-label">Hundreds</div></div>
  <div class="column" id="tens"><div class="column-label">Tens</div></div>
  <div class="column" id="ones"><div class="column-label">Ones</div></div>
</div>

<div id="equation">___ ___ ___ + ___ ___ ___ = ___ ___ ___</div>

<script>
const cols = {
  flat: document.getElementById("hundreds"),
  rod: document.getElementById("tens"),
  unit: document.getElementById("ones")
};

let currentRow = 1;

/* ---------- ROW HELPERS ---------- */
function getRow(col) {
  let row = col.querySelector(".row" + currentRow);
  if (!row) {
    row = document.createElement("div");
    row.className = "row row" + currentRow;
    col.appendChild(row);
  }
  return row;
}

/* ---------- AUTO REGROUP CHECK ---------- */
function checkRegroup(rowNum) {
  const ones = document.querySelectorAll(`.row${rowNum} .unit`);
  const tens = document.querySelectorAll(`.row${rowNum} .rod`);

  while (ones.length >= 10) {
    for (let i = 0; i < 10; i++) ones[i].remove();
    addBlock("rod", rowNum);
  }

  while (tens.length >= 10) {
    for (let i = 0; i < 10; i++) tens[i].remove();
    addBlock("flat", rowNum);
  }
}

/* ---------- ADD BLOCK ---------- */
function addBlock(type, rowNum = currentRow) {
  const block = document.createElement("div");
  block.className = "block " + type;
  block.draggable = true;

  block.addEventListener("dragstart", e => {
    e.dataTransfer.setData("text", type);
  });

  getRow(cols[type]).appendChild(block);
  checkRegroup(rowNum);
}

/* ---------- DRAG BREAKDOWN ---------- */
Object.entries(cols).forEach(([type, col]) => {
  col.addEventListener("dragover", e => e.preventDefault());

  col.addEventListener("drop", e => {
    e.preventDefault();
    const fromType = e.dataTransfer.getData("text");
    if (fromType === type) return;

    const sourceRow = document.querySelector(`.row${currentRow} .${fromType}`);
    if (!sourceRow) return;
    sourceRow.remove();

    if (fromType === "rod" && type === "unit") {
      for (let i = 0; i < 10; i++) addBlock("unit");
    }
    if (fromType === "flat" && type === "rod") {
      for (let i = 0; i < 10; i++) addBlock("rod");
    }
  });
});

/* ---------- PALETTE ---------- */
document.querySelectorAll("#availableBlocks .block").forEach(b => {
  b.onclick = () =>
    addBlock(
      b.classList.contains("flat") ? "flat" :
      b.classList.contains("rod") ? "rod" : "unit"
    );
});

/* ---------- CONTROLS ---------- */
document.getElementById("setup").onclick = () => {
  Object.values(cols).forEach(c =>
    c.innerHTML = `<div class="column-label">${c.querySelector(".column-label").innerText}</div>`
  );
  currentRow = 1;
  document.getElementById("equation").innerText =
    document.getElementById("problemInput").value.replace(/\d+/g, "___");
};

document.getElementById("switchRow").onclick = () => {
  currentRow = currentRow === 1 ? 2 : 1;
};
</script>

</body>
</html>

